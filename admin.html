<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Admin Panel - Projects</title>
    <style>
        body { background: #f5f8fa; font-family: Segoe UI, Arial; padding: 2em; }
        .admin-box { background: #fff; border-radius: 12px; box-shadow: 0 2px 16px rgba(0,0,0,0.08); padding: 2em; max-width: 410px; margin: 40px auto; }
        input, select, textarea { width: 100%; margin-bottom: 16px; padding: 8px; font-size:1em; border-radius: 5px; border:1px solid #ccc;}
        button { padding: 0.7em 2em; font-size:1em; border: none; border-radius: 8px; background: #37ad5c; color: #fff; cursor: pointer;}
        #back-btn { background: #4477b6; }
        #lookup-btn { background: #FFA500; }
        .hidden { display:none;}
        .error { color: #d21034; margin-bottom: 16px;}
        .info { color: #448811; margin-bottom: 16px;}
    </style>
</head>
<body>
    <div class="admin-box">
        <h2>Admin Login</h2>
        <div id="login-box">
            <input id="username" type="text" placeholder="Username" />
            <input id="password" type="password" placeholder="Password" />
            <button id="login-btn">Login</button>
            <div id="login-error" class="error"></div>
        </div>
        <div id="form-box" class="hidden">
            <h2>Add Project</h2>
            <input id="name" placeholder="Project name">
            <select id="status">
                <option value="Planned">Planned</option>
                <option value="In-Progress">In-Progress</option>
            </select>
            <input id="budget" type="number" placeholder="Budget (CAD)">
            <input id="province" placeholder="Province">
            <input id="city" placeholder="City/Town">
            <input id="country" placeholder="Country">
            <button id="lookup-btn" type="button">Lookup coordinates</button>
            <input id="latitude" type="number" step="any" placeholder="Latitude (auto)">
            <input id="longitude" type="number" step="any" placeholder="Longitude (auto)">
            <div id="lookup-info" class="info"></div>
            <textarea id="description" placeholder="Description"></textarea>
            <textarea id="reason" placeholder="Reason"></textarea>
            <input id="planneddate" type="date" placeholder="Planned date">
            <button id="save-btn">Save Project</button>
            <button id="back-btn" style="margin-top:10px;">Back</button>
        </div>
    </div>
<script>
// Simple local login
document.getElementById('login-btn').onclick = function() {
    var u = document.getElementById('username').value;
    var p = document.getElementById('password').value;
    if (u === 'admin' && p === 'admin') {
        document.getElementById('login-box').classList.add('hidden');
        document.getElementById('form-box').classList.remove('hidden');
    } else {
        document.getElementById('login-error').innerText = "Wrong username or password!";
    }
};

// Geocoding via Nominatim for city/province/country to coordinates
document.getElementById('lookup-btn').onclick = function() {
    var city = document.getElementById('city').value.trim();
    var province = document.getElementById('province').value.trim();
    var country = document.getElementById('country').value.trim();
    var infoDiv = document.getElementById('lookup-info');
    infoDiv.textContent = "";
    if(!city || !country) {
        infoDiv.textContent = "Enter at least city/town AND country.";
        return;
    }
    var url = "https://nominatim.openstreetmap.org/search?format=json&q="
        + encodeURIComponent(city + ', ' + province + ', ' + country);
    fetch(url)
    .then(res => res.json())
    .then(function(data){
        if(data.length > 0) {
            document.getElementById('latitude').value = data[0].lat;
            document.getElementById('longitude').value = data[0].lon;
            infoDiv.textContent = "Coordinates found: " + data[0].lat + ", " + data[0].lon;
        } else {
            infoDiv.textContent = "No location found for this entry.";
        }
    })
    .catch(function(){
        infoDiv.textContent = "Lookup failed. Try again.";
    });
};

// Local save
document.getElementById('save-btn').onclick = function() {
    var project = {
        name: document.getElementById('name').value,
        status: document.getElementById('status').value,
        budget: parseFloat(document.getElementById('budget').value),
        province: document.getElementById('province').value,
        city: document.getElementById('city').value,
        country: document.getElementById('country').value,
        latitude: parseFloat(document.getElementById('latitude').value) || null,
        longitude: parseFloat(document.getElementById('longitude').value) || null,
        description: document.getElementById('description').value,
        reason: document.getElementById('reason').value,
        planneddate: document.getElementById('planneddate').value
    };

    localStorage.setItem('pendingProject', JSON.stringify(project));
    alert("Project ready to load! Switch back to main map.");
    window.location.href = "index.html";
};

// Back button
document.getElementById('back-btn').onclick = function() {
    window.location.href = "index.html";
};
</script>
</body>
</html>
